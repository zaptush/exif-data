{"version":3,"file":"exif-data.umd.js","sources":["exif-data.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\n/**\n * `exif-data`\n * `obtain exif data from slotted elements`\n * @demo demo/index.html\n * @element exif-data\n */\nclass ExifData extends HTMLElement {\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"exif-data\";\n  }\n  // simple path from a url modifier\n  pathFromUrl(url) {\n    return url.substring(0, url.lastIndexOf(\"/\") + 1);\n  }\n  get html() {\n    return `\n    <style>\n      ul.showdata {\n        z-index: 1;\n        visibility: visible;\n        opacity: .9;\n      }\n      ul {\n        position: absolute;\n        transition: 0.3s linear all;\n        background-color: #000000;\n        opacity: 0;\n        visibility: hidden;\n        overflow: scroll;\n        padding: 0;\n        margin: 0;\n      }\n      ul li {\n        padding: 8px;\n        font-size: 14px;\n        color: white;\n      }\n    </style>\n    <slot></slot>\n    <ul id=\"data\"></ul>`;\n  }\n  render() {\n    this.shadowRoot.innerHTML = null;\n    this.template.innerHTML = this.html;\n    this.shadowRoot.appendChild(this.template.content.cloneNode(true));\n  }\n  /**\n   * life cycle\n   */\n  constructor() {\n    super();\n    this.nodeData = [];\n    const basePath = this.pathFromUrl(decodeURIComponent(import.meta.url));\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(\"exif-js\", `${basePath}lib/exif-js.js`);\n    window.addEventListener(\n      \"es-bridge-exif-js-loaded\",\n      this._onExifJsLoaded.bind(this)\n    );\n    this.template = document.createElement(\"template\");\n    this.attachShadow({ mode: \"open\" });\n    this.render();\n  }\n  /**\n   * Library loaded\n   */\n  _onExifJsLoaded() {\n    window.removeEventListener(\n      \"es-bridge-exif-js-loaded\",\n      this._onExifJsLoaded.bind(this)\n    );\n    this.__ready = true;\n    this.updateExif();\n  }\n  showDetails(item) {\n    if (!item) {\n      return;\n    }\n    let target = this.alignTarget;\n    if (!target) {\n      target = item.node;\n    }\n    const dim = target.getBoundingClientRect();\n    var content = \"\";\n    for (var key in item.data) {\n      if (\n        item.data[key] != \"\" &&\n        item.data[key] != false &&\n        item.data[key] != \" \" &&\n        item.data[key] != 0 &&\n        item.data[key] != null\n      ) {\n        content += `<li><strong>${key}</strong>: ${item.data[key]}</li>`;\n      }\n    }\n    this.dataElement.innerHTML = content;\n    if (this.alignTargetTop) {\n      this.dataElement.style.top = this.alignTargetTop;\n    } else {\n      this.dataElement.style.top = dim.top + \"px\";\n    }\n    this.dataElement.style.height = dim.height + \"px\";\n    this.dataElement.style.width = dim.width + \"px\";\n    if (!this.noLeft) {\n      this.dataElement.style.left = dim.left + \"px\";\n    }\n    this.dataElement.classList.add(\"showdata\");\n  }\n  clickImage(e) {\n    if (e.target.tagName === \"IMG\") {\n      this.nodeData.forEach(item => {\n        if (item.node === e.target) {\n          this.showDetails(item);\n        }\n      });\n    }\n  }\n  /**\n   * Load exifData\n   */\n  getExifData(node) {\n    window.EXIF.getData(node, () => {\n      let data = window.EXIF.getAllTags(node);\n      // REALLY verbose field\n      delete data.MakerNote;\n      delete data.thumbnail;\n      this.nodeData.push({\n        node: node,\n        data: data\n      });\n    });\n  }\n  updateExif(show = false) {\n    this.nodeData = [];\n    this.dataElement.innerHTML = \"\";\n    this.childNodes.forEach(node => {\n      if (this.__ready && node.tagName && node.tagName === \"IMG\") {\n        this.getExifData(node);\n      }\n    });\n    if (show && this.children.length === 1) {\n      setTimeout(() => {\n        this.showDetails(this.nodeData[0]);\n      }, 250);\n    }\n  }\n  clickData(e) {\n    this.dataElement.classList.remove(\"showdata\");\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    if (window.ShadyCSS) {\n      window.ShadyCSS.styleElement(this);\n    }\n    this.dataElement = this.shadowRoot.querySelector(\"#data\");\n    if (this.getAttribute(\"no-events\") == null) {\n      this.addEventListener(\"click\", this.clickImage.bind(this));\n      this.dataElement.addEventListener(\"click\", this.clickData.bind(this));\n    }\n    if (this.getAttribute(\"no-left\") == null) {\n      this.noLeft = false;\n    } else {\n      this.noLeft = true;\n    }\n    // any change, update things\n    this.observer = new MutationObserver(mutations => {\n      this.updateExif();\n    });\n    this.observer.observe(this, {\n      childList: true\n    });\n  }\n\n  disconnectedCallback() {\n    if (this.getAttribute(\"no-events\") == null) {\n      this.removeEventListener(\"click\", this.clickImage.bind(this));\n      this.dataElement.removeEventListener(\"click\", this.clickData.bind(this));\n    }\n    this.observer.disconnect();\n  }\n}\nwindow.customElements.define(ExifData.tag, ExifData);\nexport { ExifData };\n"],"names":["ExifData","nodeData","basePath","_this","pathFromUrl","decodeURIComponent","window","ESGlobalBridge","requestAvailability","instance","load","addEventListener","_onExifJsLoaded","bind","template","document","createElement","attachShadow","mode","render","HTMLElement","url","substring","lastIndexOf","shadowRoot","innerHTML","this","html","appendChild","content","cloneNode","removeEventListener","__ready","updateExif","item","target","alignTarget","node","dim","getBoundingClientRect","key","data","dataElement","alignTargetTop","style","top","height","width","noLeft","left","classList","add","e","tagName","forEach","_this2","showDetails","EXIF","getData","getAllTags","MakerNote","thumbnail","_this3","push","show","childNodes","_this4","getExifData","children","length","setTimeout","remove","ShadyCSS","styleElement","querySelector","getAttribute","clickImage","clickData","observer","MutationObserver","mutations","_this5","observe","childList","disconnect","customElements","define","tag"],"mappings":"6xDAWMA,4NAiDGC,SAAW,OACVC,EAAWC,EAAKC,YAAYC,gNAClCC,OAAOC,eAAeC,sBACtBF,OAAOC,eAAeE,SAASC,KAAK,oBAAcR,qBAClDI,OAAOK,iBACL,2BACAR,EAAKS,gBAAgBC,cAElBC,SAAWC,SAASC,cAAc,cAClCC,aAAa,CAAEC,KAAM,WACrBC,yPA3DcC,qDASTC,UACHA,EAAIC,UAAU,EAAGD,EAAIE,YAAY,KAAO,yCA8B1CC,WAAWC,UAAY,UACvBX,SAASW,UAAYC,KAAKC,UAC1BH,WAAWI,YAAYF,KAAKZ,SAASe,QAAQC,WAAU,8kBApCrD,6DA2DPxB,OAAOyB,oBACL,2BACAL,KAAKd,gBAAgBC,KAAKa,YAEvBM,SAAU,OACVC,iDAEKC,MACLA,OAGDC,EAAST,KAAKU,YACbD,IACHA,EAASD,EAAKG,UAEVC,EAAMH,EAAOI,wBACfV,EAAU,OACT,IAAIW,KAAON,EAAKO,KAEC,IAAlBP,EAAKO,KAAKD,IACQ,GAAlBN,EAAKO,KAAKD,IACQ,KAAlBN,EAAKO,KAAKD,IACQ,GAAlBN,EAAKO,KAAKD,IACQ,MAAlBN,EAAKO,KAAKD,KAEVX,yBAA0BW,wBAAiBN,EAAKO,KAAKD,kBAGpDE,YAAYjB,UAAYI,EACzBH,KAAKiB,oBACFD,YAAYE,MAAMC,IAAMnB,KAAKiB,oBAE7BD,YAAYE,MAAMC,IAAMP,EAAIO,IAAM,UAEpCH,YAAYE,MAAME,OAASR,EAAIQ,OAAS,UACxCJ,YAAYE,MAAMG,MAAQT,EAAIS,MAAQ,KACtCrB,KAAKsB,cACHN,YAAYE,MAAMK,KAAOX,EAAIW,KAAO,WAEtCP,YAAYQ,UAAUC,IAAI,gDAEtBC,cACgB,QAArBA,EAAEjB,OAAOkB,cACNpD,SAASqD,QAAQ,SAAApB,GAChBA,EAAKG,OAASe,EAAEjB,QAClBoB,EAAKC,YAAYtB,yCAQbG,cACV/B,OAAOmD,KAAKC,QAAQrB,EAAM,eACpBI,EAAOnC,OAAOmD,KAAKE,WAAWtB,UAE3BI,EAAKmB,iBACLnB,EAAKoB,UACZC,EAAK7D,SAAS8D,KAAK,CACjB1B,KAAMA,EACNI,KAAMA,sDAIDuB,+DACJ/D,SAAW,QACXyC,YAAYjB,UAAY,QACxBwC,WAAWX,QAAQ,SAAAjB,GAClB6B,EAAKlC,SAAWK,EAAKgB,SAA4B,QAAjBhB,EAAKgB,SACvCa,EAAKC,YAAY9B,KAGjB2B,GAAiC,IAAzBtC,KAAK0C,SAASC,QACxBC,WAAW,WACTJ,EAAKV,YAAYU,EAAKjE,SAAS,KAC9B,uCAGGmD,QACHV,YAAYQ,UAAUqB,OAAO,mEAM9BjE,OAAOkE,UACTlE,OAAOkE,SAASC,aAAa/C,WAE1BgB,YAAchB,KAAKF,WAAWkD,cAAc,SACX,MAAlChD,KAAKiD,aAAa,oBACfhE,iBAAiB,QAASe,KAAKkD,WAAW/D,KAAKa,YAC/CgB,YAAY/B,iBAAiB,QAASe,KAAKmD,UAAUhE,KAAKa,QAE7B,MAAhCA,KAAKiD,aAAa,gBACf3B,QAAS,OAETA,QAAS,OAGX8B,SAAW,IAAIC,iBAAiB,SAAAC,GACnCC,EAAKhD,oBAEF6C,SAASI,QAAQxD,KAAM,CAC1ByD,WAAW,mDAKyB,MAAlCzD,KAAKiD,aAAa,oBACf5C,oBAAoB,QAASL,KAAKkD,WAAW/D,KAAKa,YAClDgB,YAAYX,oBAAoB,QAASL,KAAKmD,UAAUhE,KAAKa,aAE/DoD,SAASM,sBAGlB9E,OAAO+E,eAAeC,OAAOtF,EAASuF,IAAKvF"}